# Stage 1 – Baseline Vulnerability Assessment

## Overview
The project ships with intentionally vulnerable Angular components located in:

- `src/app/services/auth.service.vulnerable.ts`
- `src/app/components/login/login.component.vulnerable.ts`
- `src/app/components/user-profile/user-profile.component.vulnerable.ts`

Your goal in this stage is to catalogue risks, align them with governance guardrails, and prepare remediation guidance before fixing the files in place.

## Vulnerabilities Included

### auth.service.vulnerable.ts
1. **Insecure Storage**: Storing JWT tokens in localStorage (should use httpOnly cookies)
2. **Storing Passwords**: Encoding and storing user passwords
3. **Sensitive Data Logging**: Logging credentials to console
4. **Incomplete Logout**: Not clearing all sensitive data on logout
5. **Client-side Role Check**: Trusting client-side role verification
6. **No CSRF Protection**: Missing CSRF tokens on state-changing requests

### login.component.vulnerable.ts
1. **XSS Vulnerability**: Using [innerHTML] with error messages
2. **No Input Validation**: Missing form validation and sanitization
3. **Open Redirect**: Unvalidated returnUrl parameter
4. **Information Disclosure**: Exposing system information in debug mode
5. **Error Information Leakage**: Showing detailed error messages
6. **Credential Logging**: Logging username and password on errors

### user-profile.component.vulnerable.ts
1. **XSS Vulnerability**: Using [innerHTML] with user-generated content
2. **Memory Leak**: setInterval without cleanup (no unsubscribe)
3. **Direct DOM Manipulation**: Using document.getElementById instead of Renderer2
4. **File Upload Without Validation**: No file type or size checks
5. **Missing Error Handling**: No error handlers on HTTP requests
6. **Exposing Sensitive Data**: Displaying API keys and session IDs
7. **CSRF Vulnerability**: No CSRF protection on form submissions

## Stage Goals
- Capture an executive summary of the current risk profile.
- Map each vulnerability to OWASP categories and note affected assets.
- Identify governance guardrails from `.github/copilot-instructions.md` that remediation work must satisfy.
- Decide which quality gates (linting, security linting, coverage, audits) you will use to prove success later.

## Recommended Actions (Stage 1)
1. Launch Copilot **Plan Mode** and ask for a risk catalog covering all three components.
2. Save the analysis as `docs/plans/stage1-plan.md` (or similar) so downstream stages inherit the findings.
3. Highlight required documentation artifacts (`VULNERABILITIES.md`, `FIXES.md`, governance report updates) that must be produced before the workflow ends.
4. Transition to Stage 2 only after the plan is vetted in **Validation Mode** and the remediation scope is clear.

---

## Stage 2 – Remediation Guidelines

Once the assessment is complete, remediate these files **in place** using Copilot:

1. Launch Copilot **Plan Mode** again to outline the remediation tasks derived from Stage 1. Capture the steps in `docs/plans/stage2-plan.md` (or equivalent) and log assumptions in `docs/workflow-tracker.md`.
2. Refactor each vulnerable component directly (no copying). Remove the `.vulnerable` suffix only after the file is secured and tests cover the change.
3. Validate every fix against `.github/copilot-instructions.md` guardrails—secure storage, sanitization, CSRF protection, error handling, etc.
4. Record successful commands (`npm run lint`, `npm run lint:security`, `npm run test:coverage`, `npm audit --audit-level=high`) along with results inside `docs/test-coverage.md`.
5. Document completed work, remaining risks, and follow-up items in `docs/workflow-tracker.md` before moving to Stage 3.
